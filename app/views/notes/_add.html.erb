<% unless session[:user] %>
	Please <%= link_to "login", "/login" %> to submit notes
<% else %>

<% unless defined?(exclude_js) %>
	<script type="text/javascript">
		if (typeof BP_NOTES_LOADED == 'undefined') jQuery.getScript("/javascripts/bp_notes.js");
		if (typeof BP_FORM_COMPLETE_LOADED == 'undefined') jQuery.getScript("/javascripts/widgets/form_complete.js");
	</script>
<% end %>

<% action_type = defined?(action) ? action : "" %>
<% prefix = defined?(action) ? action + "_" : "" %>

<style type="text/css">
	/* Create new note */
	.create_note_container {
		padding: .5em;
		width: 750px;
	}
	.create_note_buttons {
		padding: .5em;
		margin-bottom: -1px;
	}
	.create_note_submit {
		cursor: pointer;
		color: #234979;
        background: white;
        border: 1px solid #C1DAD7;
        margin: 5px 5px 5px 0;
        padding: 5px 7px;
        text-align: center;
        width: 50px;
		text-decoration: none;
	}
	.create_note_submit:hover {
		background: #234979;
		color: white;
	}
	.note_buttons {
		background: #E2EBF0;
		color: #234979;
		border-top: 1px solid #C1DAD7;
		border-left: 1px solid #C1DAD7;
		border-right: 1px solid #C1DAD7;
		padding: .5em;
	}
	.note_buttons:hover {
		background: none;
		cursor: pointer;
	}
	.create_note_options {
		background: #E2EBF0;
		padding: .5em;
		border: 1px solid #C1DAD7;
	}
	.create_note_selected {
		background: white;
	}
	.note_options {
		display: none;
	}
	.create_note_inputs {
		width: 350px;
		margin-bottom: .5em;
	}
	textarea.create_note_inputs {
		height: 200px;
	}
	.note_options_float {
		float: right;
		padding: 0 1em 0 .5em;
	}
	.new_note {
		background: #F5FAFA;
	}
	.error_message {
		color: red;
		font-weight: bold;
	}
</style>

<script type="text/javascript">
	jQuery(document).ready(function() {
		// Set data for retrieval
		jQuery(".<%=prefix%>note_submit_data").data("prefix", "<%=prefix%>");
		jQuery(".<%=prefix%>note_submit_data").data("action", "<%=action_type%>");
		jQuery(".<%=prefix%>note_submit_data").data("ont_id", "<%= @ontology.ontologyId %>");

		// Wire up the tabs in the 'Add Note' form box
		jQuery('.<%=prefix%>note_action').click(function(){
			var prefix = "<%=prefix%>";
			var spanId = jQuery(this).attr("id");
			var noteTypeId = jQuery(this).attr("note_type");
			jQuery('.' + prefix + 'note_options_action').hide();
			jQuery('#' + noteTypeId).show();
			jQuery('.' + prefix + 'note_action').removeClass("create_note_selected");
			jQuery(this).addClass("create_note_selected");
		});
	});
</script>


<h1>Add Note</h1>
<div id="<%=prefix%>create_note_container" class="create_note_container">
	<div id="<%=prefix%>create_note_buttons" class="create_note_buttons">
		<span id="<%=prefix%>create_note_comment_button" note_type="<%=prefix%>create_note_comment" class="<%=prefix%>note_action note_buttons create_note_selected">Comment</span>
		<span id="<%=prefix%>create_note_new_term_button" note_type="<%=prefix%>create_note_new_term" class="<%=prefix%>note_action note_buttons">Propose New Term</span>
		<span id="<%=prefix%>create_note_change_hierarchy_button" note_type="<%=prefix%>create_note_change_hierarchy" class="<%=prefix%>note_action note_buttons">Propose Relationship Change</span>
		<span id="<%=prefix%>create_note_change_prop_value_button" note_type="<%=prefix%>create_note_change_prop_value" class="<%=prefix%>note_action note_buttons">Propose Property Value Change</span>
	</div>
	
	<div id="<%=prefix%>create_note_options" class="create_note_options">
		
		<div id="<%=prefix%>create_note_comment" class="<%=prefix%>note_options_action note_options" style="display: block;">
			<input type="hidden" id="<%=prefix%>create_comment_appliesTo" value="<%= applies_to rescue "" %>" class="create_comment_inputs">
			<input type="hidden" id="<%=prefix%>create_comment_appliesToType" value="<%= applies_to_type rescue "" %>" class="create_comment_inputs">
			<input type="hidden" id="<%=prefix%>create_comment_noteType" value="Comment" class="create_comment_inputs">
			<input type="hidden" id="<%=prefix%>create_comment_author" value="<%= session[:user].id %>" class="create_comment_inputs">
				
			<h2>Comment</h2>
			Subject<br/>
			<input id='<%=prefix%>create_comment_subject' class="create_note_inputs create_comment_inputs"><br/>
			Body<br/>
			<textarea id='<%=prefix%>create_comment_body' class="create_note_inputs create_comment_inputs"></textarea><br>
			
			<div id="<%=prefix%>create_comment_submit_container">
				<button id="<%=prefix%>create_comment" note_type="create_comment" class="create_note_submit <%=prefix%>note_submit_data">submit</button>
			</div>
		</div>
		
		<div id="<%=prefix%>create_note_new_term" class="<%=prefix%>note_options_action note_options">
			<div id="<%=prefix%>create_note_new_term_float" class="note_options_float">
				<input type="hidden" id="<%=prefix%>create_new_term_appliesTo" value="<%= applies_to rescue "" %>" class="create_new_term_inputs">
				<input type="hidden" id="<%=prefix%>create_new_term_appliesToType" value="<%= applies_to_type rescue "" %>" class="create_new_term_inputs">
				<input type="hidden" id="<%=prefix%>create_new_term_noteType" value="ProposalForCreateEntity" class="create_new_term_inputs">
				<input type="hidden" id="<%=prefix%>create_new_term_author" value="<%= session[:user].id %>" class="create_new_term_inputs">
				
				Reason for change<br/>
				<input type="text" id="<%=prefix%>create_new_term_reasonForChange" class="create_note_inputs create_new_term_inputs"><br/>
				Contact information (publically visible)<br/>
				<input type="text" id="<%=prefix%>create_new_term_contactInfo" class="create_note_inputs create_new_term_inputs"><br/>
				Definition<br/>
				<input type="text" id="<%=prefix%>termDefinition" class="create_note_inputs create_new_term_inputs"><br/>
				Proposed id<br/>
				<input type="text" id="<%=prefix%>termId" class="create_note_inputs create_new_term_inputs"><br/>
				Parent<br/>
				<input type="text" name="<%=prefix%>termParent" id="<%=prefix%>termParent" value="<%= @concept.fullId rescue "" %>" class="create_note_inputs create_new_term_inputs bp_form_complete-<%= @ontology.ontologyId %>-uri"><br/>
				Preferred name<br/>
				<input type="text" id="<%=prefix%>termPreferredName" class="create_note_inputs create_new_term_inputs"><br/>
				Synonyms (comma-separated list)<br/>
				<input type="text" id="<%=prefix%>termSynonyms" class="create_note_inputs create_new_term_inputs"><br/>
			</div>
			<h2>New Term</h2>
			Subject<br/>
			<input id='<%=prefix%>create_new_term_subject' class="create_note_inputs create_new_term_inputs"><br/>
			Body<br/>
			<textarea id='<%=prefix%>create_new_term_body' class="create_note_inputs create_new_term_inputs"></textarea><br>

			<div id="<%=prefix%>create_new_term_submit_container">
				<button id="<%=prefix%>create_new_term" note_type="create_new_term" class="create_note_submit <%=prefix%>note_submit_data">submit</button>
			</div>
		</div>
		
		<div id="<%=prefix%>create_note_change_hierarchy" class="<%=prefix%>note_options_action note_options">
			<div id="<%=prefix%>create_change_hierarchy_float" class="note_options_float">
				<input type="hidden" id="<%=prefix%>create_change_hierarchy_appliesTo" value="<%= applies_to rescue "" %>" class="create_change_hierarchy_inputs">
				<input type="hidden" id="<%=prefix%>create_change_hierarchy_appliesToType" value="<%= applies_to_type rescue "" %>" class="create_change_hierarchy_inputs">
				<input type="hidden" id="<%=prefix%>create_change_hierarchy_noteType" value="ProposalForChangeHierarchy" class="create_change_hierarchy_inputs">
				<input type="hidden" id="<%=prefix%>create_change_hierarchy_author" value="<%= session[:user].id %>" class="create_change_hierarchy_inputs">
				
				Reason for change<br/>
				<input type="text" id="<%=prefix%>create_change_hierarchy_reasonForChange" class="create_note_inputs create_change_hierarchy_inputs"><br/>
				Contact information (publically visible)<br/>
				<input type="text" id="<%=prefix%>create_change_hierarchy_contactInfo" class="create_note_inputs create_change_hierarchy_inputs"><br/>
				Old relationship target (start typing to autocomplete)<br/>
				<input type="text" name="<%=prefix%>oldRelationshipTarget" id="<%=prefix%>oldRelationshipTarget" class="bp_form_complete-<%= @ontology.ontologyId %>-uri create_note_inputs create_change_hierarchy_inputs"><br/>
				New relationship target (start typing to autocomplete)<br/>
				<input type="text" name="<%=prefix%>relationshipTarget" id="<%=prefix%>relationshipTarget" class="bp_form_complete-<%= @ontology.ontologyId %>-uri create_note_inputs create_change_hierarchy_inputs"><br/>
				New relationship type<br/>
				<select id="<%=prefix%>relationshipType">
					<option selected></option>
					<%= options_for_select([["is_a", "is_a"], ["part_of", "part_of"], ["integral_part_of", "integral_part_of"],
						["proper_part_of", "proper_part_of"], ["located_in", "located_in"], ["contained_in", "contained_in"],
						["adjacent_to", "adjacent_to"], ["transformation_of", "transformation_of"], ["derives_from", "preceded_by"],
						["has_participant", "has_participant"], ["has_agent", "has_agent"], ["instance_of", "instance_of"]]) %>
				</select>
			</div>
			<h2>New Relationship / Change Hierarchy</h2>
			Subject<br/>
			<input id='<%=prefix%>create_change_hierarchy_subject' class="create_note_inputs create_change_hierarchy_inputs"><br/>
			Body<br/>
			<textarea id='<%=prefix%>create_change_hierarchy_body' class="create_note_inputs create_change_hierarchy_inputs"></textarea><br>

			<div id="<%=prefix%>create_change_hierarchy_submit_container">
				<button id="<%=prefix%>create_change_hierarchy" note_type="create_change_hierarchy" class="create_note_submit <%=prefix%>note_submit_data">submit</button>
			</div>
		</div>
		
		<div id="<%=prefix%>create_note_change_prop_value" class="<%=prefix%>note_options_action note_options">
			<div id="<%=prefix%>create_change_prop_value_float" class="note_options_float">
				<input type="hidden" id="<%=prefix%>create_change_prop_value_appliesTo" value="<%= applies_to rescue "" %>" class="create_change_prop_value_inputs">
				<input type="hidden" id="<%=prefix%>create_change_prop_value_appliesToType" value="<%= applies_to_type rescue "" %>" class="create_change_prop_value_inputs">
				<input type="hidden" id="<%=prefix%>create_change_prop_value_noteType" value="ProposalForChangePropertyValue" class="create_change_prop_value_inputs">
				<input type="hidden" id="<%=prefix%>create_change_prop_value_author" value="<%= session[:user].id %>" class="create_change_prop_value_inputs">
				
				Reason for change<br/>
				<input type="text" id="<%=prefix%>create_change_prop_value_reasonForChange" class="create_note_inputs create_change_prop_value_inputs"><br/>
				Contact information (publically visible)<br/>
				<input type="text" id="<%=prefix%>create_change_prop_value_contactInfo" class="create_note_inputs create_change_prop_value_inputs"><br/>
				Property id<br/>
				<input type="text" id="<%=prefix%>propertyId" class="create_note_inputs create_change_prop_value_inputs"><br/>
				New property value<br/>
				<input type="text" id="<%=prefix%>newPropertyValue" class="create_note_inputs create_change_prop_value_inputs"><br/>
				Old property value<br/>
				<input type="text" id="<%=prefix%>oldPropertyValue" class="create_note_inputs create_change_prop_value_inputs"><br/>
			</div>
			<h2>Change Property Value</h2>
			Subject<br/>
			<input id='<%=prefix%>create_change_prop_value_subject' class="create_note_inputs create_change_prop_value_inputs"><br/>
			Body<br/>
			<textarea id='<%=prefix%>create_change_prop_value_body' class="create_note_inputs create_change_prop_value_inputs"></textarea><br>
			
			<div id="<%=prefix%>create_change_prop_value_submit_container">
				<button id="<%=prefix%>create_change_prop_value" note_type="create_change_prop_value" class="create_note_submit <%=prefix%>note_submit_data">submit</button>
			</div>
		</div>
	</div>
</div>

<% end %> <!-- end check for logged in user -->