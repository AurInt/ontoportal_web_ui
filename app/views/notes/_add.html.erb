<% unless defined?(exclude_js) %>
	<%= javascript_include_tag "bp_notes.js" %>
	<%= javascript_include_tag "widgets/form_complete.js" %>
<% end %>

<% action_type = defined?(action) ? action : "" %>
<% prefix = defined?(action) ? action + "_" : "" %>

<style type="text/css">
	/* Create new note */
	.create_note_container {
		padding: .5em;
		width: 750px;
	}
	.create_note_buttons {
		padding: .5em;
		margin-bottom: -1px;
	}
	.note_buttons {
		background: #E2EBF0;
		color: #234979;
		border-top: 1px solid #C1DAD7;
		border-left: 1px solid #C1DAD7;
		border-right: 1px solid #C1DAD7;
		padding: .5em;
	}
	.note_buttons:hover {
		background: none;
		cursor: pointer;
	}
	.create_note_options {
		background: #E2EBF0;
		padding: .5em;
		border: 1px solid #C1DAD7;
	}
	.create_note_selected {
		background: white;
	}
	.note_options {
		display: none;
	}
	.create_note_inputs {
		width: 350px;
		margin-bottom: .5em;
	}
	textarea.create_note_inputs {
		height: 200px;
	}
	.note_options_float {
		float: right;
		padding: 0 1em 0 .5em;
	}
	.new_note {
		background: #F5FAFA;
	}
</style>

<script type="text/javascript">
	jQuery(document).ready(function() {
		var prefix = "<%=prefix%>";
		jQuery('.<%=prefix%>note_action').click(function(){
			var prefix = "<%=prefix%>";
			var spanId = jQuery(this).attr("id");
			var noteTypeId = jQuery(this).attr("note_type");
			jQuery('.' + prefix + 'note_options_action').hide();
			jQuery('#' + noteTypeId).show();
			jQuery('.' + prefix + 'note_action').removeClass("create_note_selected");
			jQuery(this).addClass("create_note_selected");
		});
		
		jQuery(document.body).append('<input type="hidden" id="BP_REST_URL" value="<%= $REST_URL %>">');
		jQuery(document.body).append('<input type="hidden" id="ONT" value="<%= @ontology.ontologyId %>">');
		
		<% unless prefix.nil? || prefix.empty? %>
			jQuery(document.body).append('<input type="hidden" id="PREFIX" value="<%= prefix %>">');
		<% end %>

		// Set data for retrieval
		jQuery("#<%=prefix%>create_comment").data("prefix", "<%=prefix%>");
		jQuery("#<%=prefix%>create_new_term").data("prefix", "<%=prefix%>");
		jQuery("#<%=prefix%>create_change_hierarchy").data("prefix", "<%=prefix%>");
		jQuery("#<%=prefix%>create_change_prop_value").data("prefix", "<%=prefix%>");
		jQuery("#<%=prefix%>create_comment").data("action_type", "<%=action%>");
		jQuery("#<%=prefix%>create_new_term").data("action_type", "<%=action%>");
		jQuery("#<%=prefix%>create_change_hierarchy").data("action_type", "<%=action%>");
		jQuery("#<%=prefix%>create_change_prop_value").data("action_type", "<%=action%>");
	});
</script>


<h1>Add Note</h1>
<div id="<%=prefix%>create_note_container" class="create_note_container">
	<div id="<%=prefix%>create_note_buttons" class="create_note_buttons">
		<span id="<%=prefix%>create_note_comment_button" note_type="<%=prefix%>create_note_comment" class="<%=prefix%>note_action note_buttons create_note_selected">Comment</span>
		<span id="<%=prefix%>create_note_new_term_button" note_type="<%=prefix%>create_note_new_term" class="<%=prefix%>note_action note_buttons">Propose New Term</span>
		<span id="<%=prefix%>create_note_change_hierarchy_button" note_type="<%=prefix%>create_note_change_hierarchy" class="<%=prefix%>note_action note_buttons">Propose Relationship Change</span>
		<span id="<%=prefix%>create_note_change_prop_value_button" note_type="<%=prefix%>create_note_change_prop_value" class="<%=prefix%>note_action note_buttons">Propose Property Value Change</span>
	</div>
	
	<div id="<%=prefix%>create_note_options" class="create_note_options">
		
		<div id="<%=prefix%>create_note_comment" class="<%=prefix%>note_options_action note_options" style="display: block;">
			<input type="hidden" id="<%=prefix%>create_comment_appliesTo" value="<%= applies_to rescue "" %>" class="create_comment_inputs">
			<input type="hidden" id="<%=prefix%>create_comment_appliesToType" value="<%= applies_to_type rescue "" %>" class="create_comment_inputs">
			<input type="hidden" id="<%=prefix%>create_comment_noteType" value="Comment" class="create_comment_inputs">
			<input type="hidden" id="<%=prefix%>create_comment_author" value="<%= session[:user].id %>" class="create_comment_inputs">
				
			<h2>Comment</h2>
			Subject<br/>
			<input id='<%=prefix%>create_comment_subject' class="create_note_inputs create_comment_inputs"><br/>
			Body<br/>
			<textarea id='<%=prefix%>create_comment_body' class="create_note_inputs create_comment_inputs"></textarea><br>
			<a id="<%=prefix%>create_comment" note_type="create_comment" prefix="<%=prefix%>" class="create_note_submit" href="javascript:void(0)">submit</a>
		</div>
		
		<div id="<%=prefix%>create_note_new_term" class="<%=prefix%>note_options_action note_options">
			<div id="<%=prefix%>create_note_new_term_float" class="note_options_float">
				<input type="hidden" id="<%=prefix%>create_new_term_appliesTo" value="<%= applies_to rescue "" %>" class="create_new_term_inputs">
				<input type="hidden" id="<%=prefix%>create_new_term_appliesToType" value="<%= applies_to_type rescue "" %>" class="create_new_term_inputs">
				<input type="hidden" id="<%=prefix%>create_new_term_noteType" value="ProposalForNewEntity" class="create_new_term_inputs">
				<input type="hidden" id="<%=prefix%>create_new_term_author" value="<%= session[:user].id %>" class="create_new_term_inputs">
				
				Reason for change<br/>
				<input type="text" id="<%=prefix%>create_new_term_reasonForChange" class="create_note_inputs create_new_term_inputs"><br/>
				Contact information (publically visible)<br/>
				<input type="text" id="<%=prefix%>create_new_term_contactInfo" class="create_note_inputs create_new_term_inputs"><br/>
				Definition<br/>
				<input type="text" id="termDefinition" class="create_note_inputs create_new_term_inputs"><br/>
				Proposed id<br/>
				<input type="text" id="termId" class="create_note_inputs create_new_term_inputs"><br/>
				Parent<br/>
				<input type="text" name="termParent" id="termParent" value="<%= @concept.fullId rescue "" %>" class="create_note_inputs create_new_term_inputs bp_form_complete-<%= @ontology.ontologyId %>-uri"><br/>
				Preferred name<br/>
				<input type="text" id="termPreferredName" class="create_note_inputs create_new_term_inputs"><br/>
				Synonyms (comma-separated list)<br/>
				<input type="text" id="termSynonyms" class="create_note_inputs create_new_term_inputs"><br/>
			</div>
			<h2>New Term</h2>
			Subject<br/>
			<input id='<%=prefix%>create_new_term_subject' class="create_note_inputs create_new_term_inputs"><br/>
			Body<br/>
			<textarea id='<%=prefix%>create_new_term_body' class="create_note_inputs create_new_term_inputs"></textarea><br>
			<a id="<%=prefix%>create_new_term" note_type="create_new_term" prefix="<%=prefix%>" class="create_note_submit" href="javascript:void(0)">submit</a>
		</div>
		
		<div id="<%=prefix%>create_note_change_hierarchy" class="<%=prefix%>note_options_action note_options">
			<div id="<%=prefix%>create_change_hierarchy_float" class="note_options_float">
				<input type="hidden" id="<%=prefix%>create_change_hierarchy_appliesTo" value="<%= applies_to rescue "" %>" class="create_change_hierarchy_inputs">
				<input type="hidden" id="<%=prefix%>create_change_hierarchy_appliesToType" value="<%= applies_to_type rescue "" %>" class="create_change_hierarchy_inputs">
				<input type="hidden" id="<%=prefix%>create_change_hierarchy_noteType" value="ProposalForNewEntity" class="create_change_hierarchy_inputs">
				<input type="hidden" id="<%=prefix%>create_change_hierarchy_author" value="<%= session[:user].id %>" class="create_change_hierarchy_inputs">
				
				Reason for change<br/>
				<input type="text" id="<%=prefix%>create_change_hierarchy_reasonForChange" class="create_note_inputs create_change_hierarchy_inputs"><br/>
				Contact information (publically visible)<br/>
				<input type="text" id="<%=prefix%>create_change_hierarchy_contactInfo" class="create_note_inputs create_change_hierarchy_inputs"><br/>
				Old relationship target (start typing to autocomplete)<br/>
				<input type="text" name="oldRelationshipTarget" id="oldRelationshipTarget" class="bp_form_complete-<%= @ontology.ontologyId %>-uri create_note_inputs create_change_hierarchy_inputs"><br/>
				New relationship target (start typing to autocomplete)<br/>
				<input type="text" name="newRelationshipTarget" id="newRelationshipTarget" class="bp_form_complete-<%= @ontology.ontologyId %>-uri create_note_inputs create_change_hierarchy_inputs"><br/>
				New relationship type<br/>
				<select id="relationshipType">
					<option selected></option>
					<%= options_for_select([["isa", "isa"], ["partof", "partof"]]) %>
				</select>
			</div>
			<h2>Change Hierarchy</h2>
			Subject<br/>
			<input id='<%=prefix%>create_change_hierarchy_subject' class="create_note_inputs create_change_hierarchy_inputs"><br/>
			Body<br/>
			<textarea id='<%=prefix%>create_change_hierarchy_body' class="create_note_inputs create_change_hierarchy_inputs"></textarea><br>
			<a id="<%=prefix%>create_change_hierarchy" note_type="create_change_hierarchy" prefix="<%=prefix%>" class="create_note_submit" href="javascript:void(0)">submit</a>
		</div>
		
		<div id="<%=prefix%>create_note_change_prop_value" class="<%=prefix%>note_options_action note_options">
			<div id="<%=prefix%>create_change_prop_value_float" class="note_options_float">
				<input type="hidden" id="<%=prefix%>create_change_prop_value_appliesTo" value="<%= applies_to rescue "" %>" class="create_change_prop_value_inputs">
				<input type="hidden" id="<%=prefix%>create_change_prop_value_appliesToType" value="<%= applies_to_type rescue "" %>" class="create_change_prop_value_inputs">
				<input type="hidden" id="<%=prefix%>create_change_prop_value_noteType" value="ProposalForNewEntity" class="create_change_prop_value_inputs">
				<input type="hidden" id="<%=prefix%>create_change_prop_value_author" value="<%= session[:user].id %>" class="create_change_prop_value_inputs">
				
				Reason for change<br/>
				<input type="text" id="<%=prefix%>create_change_prop_value_reasonForChange" class="create_note_inputs create_change_prop_value_inputs"><br/>
				Contact information (publically visible)<br/>
				<input type="text" id="<%=prefix%>create_change_prop_value_contactInfo" class="create_note_inputs create_change_prop_value_inputs"><br/>
				Property id<br/>
				<input type="text" id="propertyId" class="create_note_inputs create_change_prop_value_inputs"><br/>
				New property value<br/>
				<input type="text" id="propertyNewValue" class="create_note_inputs create_change_prop_value_inputs"><br/>
				Old property value<br/>
				<input type="text" id="propertyOldValue" class="create_note_inputs create_change_prop_value_inputs"><br/>
			</div>
			<h2>Change Property Value</h2>
			Subject<br/>
			<input id='<%=prefix%>create_change_prop_value_subject' class="create_note_inputs create_change_prop_value_inputs"><br/>
			Body<br/>
			<textarea id='<%=prefix%>create_change_prop_value_body' class="create_note_inputs create_change_prop_value_inputs"></textarea><br>
			
			<a id="<%=prefix%>create_change_prop_value" note_type="create_change_prop_value" prefix="<%=prefix%>" class="create_note_submit" href="javascript:void(0)">submit</a>
		</div>
	</div>
</div>
