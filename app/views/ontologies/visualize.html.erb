<script src="/javascripts/jquery.resizer.js" type="text/javascript" charset="utf-8"></script>
<link rel="stylesheet" href="/javascripts/JqueryPlugins/autocomplete/jquery.autocomplete.css" type="text/css" media="screen" title="no title" charset="utf-8">
<script type="text/javascript">
var searchbox;

function jumpToValue(li){
	if( li == null ){
	// Im doing a search	
	
	var search = confirm("Concept could not be found..\n Press OK to go to the Search page or Cancel to continue browsing")
		if(search){
			jQuery("#search_keyword").val(jQuery("#search_box").val())
			jQuery("#search_form").submit()
			return
		}
	}

		// if coming from an AJAX call, let's use the CityId as the value
		if( !!li.extra ){
			
			var sValue = li.extra[0];
			
			document.location="/visualize/<%=@ontology.id%>/"+sValue;
			jQuery.blockUI({ message: '<h1><img src="/images/tree/spinner.gif" /> Loading Concept...</h1>' }); 
			return
		}

	
}

function formatItem(row) {
 	return row[0] + " <span style='font-size:9px;color:blue;'>(" + row[2] + ")</span>";
}


$(document).ready(function(){
	 $("#search_box").autocomplete("/search/json_search/<%=@ontology.ontologyId%>", { minChars:3,maxItemsToShow:20,onFindValue:jumpToValue,formatItem:formatItem });
	searchbox =  $("#search_box")[0].autocompleter;
	
});



</script>
<script src="/javascripts/JqueryPlugins/autocomplete/jquery.autocomplete.js" type="text/javascript" charset="utf-8"></script>



<div id="bd_hd">
	<h1><%=link_to @ontology.displayLabel, ontology_url(:id => @ontology.id)%></h1>

	<h3>Version <%=@ontology.versionNumber%></h3>

	<h1 id="name_label"><%=@concept.name%> <span id="link_label"> (<%=link_to "Get a direct link to this concept in BioPortal",uri_url(:ontology=>@ontology,:id=>@concept.id)%>)</span></h1>
	<br clear="all" />
	
</div>

<div id="bd_content" class="explore">
	<div id="sidebar">
		
		<div id="sd_hd">
			<h2><%=link_to "View Ontology Metadata", ontology_url(:id => @ontology.id)%></h2>
		</div>
		<div id="qsearch" >
		Jump To:<input type="textbox" id="search_box" size="30"> <input type="button" value="Go" onclick="searchbox.findValue()">
		</div>		
		<div id="sd_content">

			
			<%=render :partial => '/ontologies/treeview'%>
		</div>
		
		<div id="sd_ft">
			<p>BioPortal v2.0<br />A service of the <a href="../index.html">NCBO</a></p>
		</div>
		<div id="grab-point" >&nbsp;</div>
	</div>
	
	<div id="container">
		
		<div class="tabs">
			<ul>
					<li class="selected tab first" id="t_tab2_top"><a href="#t_tab2:">Details</a></li>
					<li class="tab" id="t_tab1_top"><a  href="#t_tab1:">Visualization</a></li>
		        	<li class="tab" id="t_tab3_top"><a  href="#t_tab3:">Notes</a></li>
					<li class="tab" id="t_tab4_top"><a  href="#t_tab4:">Mappings</a></li>				
					<%if @ontology.ontologyId.to_s.eql?("1104")%>	
					<li class="tab" id="t_tab5_top"><a  href="#t_tab5:" >Resources</a></li>			
					<%else%>							
					<li class="tab" id="t_tab5_top" onclick="callTab(5,'/resources/@ontology@/@concept@');"><a  href="#t_tab5:" alt="callTab(5,'/resources/<%=@ontology.id%>/<%=@concept.id%>')">Resources</a></li>
					<%end%>
		
			</ul>
		</div>
		<div id="contents">
			
	        	<div style="display:block;" class="tab_container" id="t_tab2"><%=render :partial =>'/concepts/details'%></div>
				<div class="tab_container" id="t_tab1"><%=render :partial =>'/concepts/images'%></div>
				<div class="tab_container" id="t_tab3"><%=render :partial =>'/margin_notes/show'%></div>
				<div class="tab_container" id="t_tab4"><%=render :partial =>'/mappings/concept_mappings'%></div>

				<%if @ontology.ontologyId.to_s.eql?("1104")%>	
					<div class="tab_container" id="t_tab5"><%=render :partial =>'/concepts/software'%></div>
				<%else%>
				<div class="tab_container" id="t_tab5"></div>
				<%end%>
		</div>
	</div>
	

</div>

<script type="text/javascript">
jQuery(document).ready(function(){
	
	
//Auto loads the correct tab
 loc = new String(document.location)
	if(loc.search("#t_tab")>=0){
		jQuery(".tab_container").hide();
		id = "#"+ loc.split("#")[1].replace(":","")
		jQuery(id).show();
		jQuery(".tab").removeClass("selected");
		jQuery(id+"_top").addClass("selected")
		tab_li = jQuery(jQuery("a[href='"+id+"']").parents().get(0))
		tab_li.addClass("selected");
		a = jQuery("a[href='"+id+":']")
		eval(a.attr("alt"));

		
	}
	
	// the tab system
	jQuery(".tab").click(function(){
		
		jQuery(".tab_container").hide();
		target = jQuery(this).children("a:first").attr("href").replace(":","") 
		jQuery(target).show();
		jQuery(".tab").removeClass("selected");
		jQuery(this).addClass("selected");

//		return false;
	});
	
	
	//Resizer, due to css issues we're gonna rig it up to be set params
//	$('#grab-point').resize({target:'#sidebar',y:false,x:450,min_width:300});

	$('#grab-point').click(function(){
		
		sidebar= $("#sidebar")
		container = $("#container")
		
		if(sidebar.css("width")=="450px"){
			sidebar.css("width","300px")
			container.css("padding-left","301px")
			$(this).css("background","url('/images/layout/bar-ext.gif') repeat-y")
		}else{
			sidebar.css("width","450px")
			container.css("padding-left","451px")
			$(this).css("background","url('/images/layout/bar-con.gif') repeat-y")
		}
		
	})
	
	
});

function callTab(tab_num,url){
    
		if(getCache(getConcept())!=null && getCache(getConcept())[tab_num]!=null){		
	        jQuery("#t_tab"+tab_num).innerHTML=getCache(getConcept())[tab_num];
	    }else{
			jQuery.blockUI({ message: '<h1><img src="/images/tree/spinner.gif" /> Loading Resources...</h1>' }); 
    		jQuery.get(url.replace("@ontology@",getOntology()).replace("@concept@",getConcept()),function(data){
				if (getCache(getConcept())!=null){
			    	getCache(getConcept())[6]=data
		    	}
				jQuery("#t_tab"+tab_num).html(data)
				jQuery.unblockUI();	
				tb_init('a.thickbox, area.thickbox, input.thickbox');
				
			});
		}

}


</script>

<style>
.tab_container{
	display:none;
}
</style>

	


<% form_for(:search, :url => {:controller =>'search',:action=>'search'},:html=>{:id=>'search_form'}) do |f| %>
<input type="hidden" name="search[ontologies][]" value="<%=@ontology.ontologyId%>">
<%=hidden_field :search, :search_type, :value=>"contains"%>
<%=hidden_field :search, :keyword, :value=>"",:id=>"search_keyword"%>
<%end%>


