<% content_section = (params[:p]) ? params[:p] : "summary" %>
<%@title = "#{@ontology.displayLabel}" %>

<%=render :partial =>'layouts/header'%>    


<!--[if gte IE 8]>
<style>
  .fg-button .ui-icon {
    margin-top: -14px;
  }
</style>
<![endif]-->
     
<!--[if IE 7]>
<style>
  #nav_ontology {
    position: absolute;
    padding-top: .5em;
    vertical-align: top !important;
  }
</style>
<![endif]-->
     
<script type="text/javascript">
  // Set the background color for this page only
  jQuery("html").css("background", "#234979");
  jQuery(document.body).css("background", "#234979");
  jQuery("#bd").css("background", "#234979");

  // Javascript History HTML5 API
  if ( typeof JSON === 'undefined' ) {
    var
      url = '/javascripts/history/json2.js',
      scriptEl = document.createElement('script');
    scriptEl.type = 'text/javascript';
    scriptEl.src = url;
    document.body.appendChild(scriptEl);
  }
  
  jQuery.rloader([
    {type:'js',src:'/javascripts/JqueryPlugins/datatables/js/jquery.dataTables.min.js'}
  ]);
  
  var ontology_id = <%=@ontology.id%>;
  var ontology_name = "<%=@ontology.displayLabel%>";
  var org_site = "<%=$ORG_SITE%>";
  var concept_id = "<%=params[:conceptid]%>";
  var content_section = "<%=content_section%>";
  var concept_param = "<%="conceptid=#{params[:conceptid]}" unless params[:conceptid].nil? || params[:conceptid].empty?%>";
  var terms_disabled = <%=@ontology.terms_disabled?%>;
</script>

<%=javascript_include_tag "history/amplify.store.js"%>  
<%=javascript_include_tag "history/history.adapter.jquery.js"%>  
<%=javascript_include_tag "history/history.js"%>
<%=javascript_include_tag "history/history.html4.js"%>
<%=javascript_include_tag "bp_ontology_viewer.js"%>
<%=javascript_include_tag "bp_notes.js"%>
<%=javascript_include_tag "bp_notes_list.js"%>
<%=javascript_include_tag "bp_notes_ont_list.js"%>

<div style="padding: 1em 2em 0; background: #234979;">
  <span style="float: right;"><a href="/syndication/rss?ontologies=<%=@ontology.ontologyId%>"><img src="/images/feed-icon.png" height=14 width=14 border=0 style="vertical-align: text-bottom;"></a></span>
  <div>
    <span style="color: white; font-size: xx-large;"><%=@ontology.displayLabel %></span>
    <span id="nav_ontology" style="padding-left: 4em; position: relative; top: -5px;">
      <a tabindex="0" href="#navigate" class="fg-button fg-button-icon-right ui-widget ui-state-default" id="ont_nav"><span class="ui-icon ui-icon-triangle-1-s"></span><span id="nav_text">Summary</span></a>
      <div id="navigate_options" class="hidden">
        <ul>
          <li class="nav_links summary_link" id="summary_link"><a href="/ontologies/<%=@ontology.id%>?p=summary" data-bp_ont_page="summary">Summary</a></li>
          <%unless @ontology.terms_disabled?%><li class="nav_links terms_link" id="terms_link"><a href="/ontologies/<%=@ontology.id%>?p=terms" data-bp_ont_page="terms">Terms</a></li><%end%>
          <li class="nav_links notes_link" id="notes_link"><a href="/ontologies/<%=@ontology.id%>?p=notes" data-bp_ont_page="notes">Notes</a></li>
          <li class="nav_links mappings_link" id="mappings_link"><a href="/ontologies/<%=@ontology.id%>?p=mappings" data-bp_ont_page="mappings">Mappings</a></li>
          <%unless @ontology.terms_disabled?%><li class="nav_links widgets_link" id="widgets_link"><a href="/ontologies/<%=@ontology.id%>?p=widgets" data-bp_ont_page="widgets">Widgets</a></li><%end%>
        </ul>
      </div>
    </span>
    
    <%if !session[:user].nil? && (session[:user].id.to_i.eql?(@ontology.userId.to_i) || session[:user].admin?) %>
      <span id="admin_ontology" style="vertical-align: super; padding-left: 1em;">
        <a tabindex="0" href="#administer" class="fg-button fg-button-icon-right ui-widget ui-state-default" id="ont_admin"><span class="ui-icon ui-icon-triangle-1-s"></span>Administer</a>
        <div id="adminster_options" class="hidden" style="text-align: left;">
          <ul>
            <li><%=link_to "Submit New Version",new_ontology_path(:id=>@ontology.ontologyId) %></li>
            <li><%=link_to "Edit Ontology Information",edit_ontology_path(:id=>@ontology.id) %></li>
          </ul>
        </div>
      </span>
    <%end %>
  </div>

  <div style="clear: both; margin-bottom: 1em;"></div>

  <div style="background: white;" id="ontology_content">
    <div id="ont_terms_content" class="ontology_viewer_content hidden">
      <%if content_section.eql?("terms")%>
        <script type="text/javascript">
          jQuery("#ont_terms_content").removeClass("hidden");
        </script>
        <%=yield%>
      <%else%>
        <%=loading_spinner(true)%>
      <%end%>
    </div>
    
    <div id="ont_summary_content" class="ontology_viewer_content hidden">
      <%if content_section.eql?("summary")%>
        <script type="text/javascript">
          jQuery("#ont_summary_content").removeClass("hidden");
        </script>
        <%=yield%>
      <%else%>
        <%=loading_spinner(true)%>
      <%end%>
    </div>

    <div id="ont_mappings_content" class="ontology_viewer_content hidden">
      <%if content_section.eql?("mappings")%>
        <script type="text/javascript">
          jQuery("#ont_mappings_content").removeClass("hidden");
        </script>
        <%=yield%>
      <%else%>
        <%=loading_spinner(true)%>
      <%end%>
    </div>

    <div id="ont_notes_content" class="ontology_viewer_content hidden">
      <%if content_section.eql?("notes")%>
        <script type="text/javascript">
          jQuery("#ont_notes_content").removeClass("hidden");
        </script>
        <%=yield%>
      <%else%>
        <%=loading_spinner(true)%>
      <%end%>
    </div>
    
    <div id="ont_widgets_content" class="ontology_viewer_content hidden">
      <%if content_section.eql?("widgets")%>
        <script type="text/javascript">
          jQuery("#ont_widgets_content").removeClass("hidden");
        </script>
        <%=yield%>
      <%else%>
        <%=loading_spinner(true)%>
      <%end%>
    </div>

  </div>
</div>

<%=render :partial =>'layouts/footer'%>          
