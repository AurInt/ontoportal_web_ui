<%@title = "Annotator"%>

<%=javascript_include_tag "JqueryPlugins/datatables/js/jquery.dataTables.js"%>
<%=javascript_include_tag "bp_annotator.js"%>

<style type="text/css">
  div#semanticTypes_chzn.chzn-container input.default {
    font-style: oblique !important;
  }

  div#semanticTypes_chzn.chzn-container-active input.default {
    font-style: normal !important;
  }

  div#annotations_filter, div#annotations_info {
    display: none;
  }

  .result_count {
    font-weight: bold;
  }
</style>

<div style="padding: 1em;">
  <h1>Annotator</h1>
  <p>
    <%=t('home.annotate.intro').nil? || t('home.annotate.intro').empty? ? "Annotate text with terms from ontologies #{help_icon("/help#Annotator_Tab")}" : t('home.annotate.intro')%>
  </p>

  <div style="padding-bottom: 1em;">
    <% textarea_title = "Please paste text here to use as an annotation source" %>
    <%=text_area :annotation, :text, :title => textarea_title, :rows => 15, :style => "box-shadow: 0 0 3px gray; padding: 5px; width: 600px;", :class => "help_text" %>

    <br style="margin-bottom: 10px;"/>

    <%=render :partial => "shared/ontology_picker", :locals => { :custom_ontologies => @annotator_ontologies }%>

    <b>Select UMLS Semantic Types</b><br/>
    <%= select_tag :semanticTypes, options_for_select(@semantic_types_for_select), :multiple => 'true', "data-placeholder".to_sym => "Type here to select UMLS semantic types", :style => "margin-bottom: 15px; width: 433px;", :class => "help_text" %><br/>

    <b>Include Mappings:</b>&nbsp;&nbsp;
    <%=check_box_tag :mappings, :automatic, false, :id => "mappings_automatic"%> <%=label_tag :mappings_automatic, "Automatic"%>&nbsp;&nbsp;
    <%=check_box_tag :mappings, :manual, false, :id => "mappings_manual"%> <%=label_tag :mappings_manual, "Manual"%><br/>

    <br/>

    <p>
      <b>Include Parents Up To Level:</b>&nbsp;&nbsp;
      <%=select_tag :levelMax, "<option value='0'>None</option><option selected='selected' value='1'>1</option><option value='2'>2</option><option value='3'>3</option><option value='4'>4</option><option value='5'>5</option><option value='6'>6</option><option value='7'>7</option><option value='8'>8</option><option value='9'>9</option><option value='10'>10</option><option value='999'>All</option>", :style => "width: 50px;"%>
    </p>

    <%=check_box_tag :wholeWordOnly, :true%> <b><%=label_tag :wholeWordOnly, "Match Whole Words Only"%></b><br/>

    <input type="button" id="annotator_button" value="Get annotations" style="margin-top: 10px;" class="link_button">
    <span class="annotator_spinner" style="display: none;"><img src="/images/spinners/spinner_000000_16px.gif" style="vertical-align: text-bottom;"></span>
    <span style='color: red;' id="annotator_error" class='annotator_error'></span>
  </div>
</div>

<div id="annotations_container" style="display: none; padding: 0 13px; margin: 0 0 2em;">
  <div style="float: right; font-style: oblique; color: gray;" id="result_counts"></div>
  <h2 style="margin-bottom: 0;">Annotations</h2>
  <div id="results_error" style="color: red; margin-bottom: 7px;"></div>
  <table id="annotations" style="display: inline-block; min-width: 700px; width: 100%;" class="zebra">
    <thead>
      <tr>
        <th>Rank</th>
        <th style="padding-right: 6px;">
          Term
          <span class="popup_container" style="padding-left: 1.7em;"><span class="bp_popup_link_container"><a href="javascript:void(0);" id="filter_terms" class="bp_popup_link">filter</a></span><div id="terms_filter_list" class="bp_popup_list" style="display: none;"></div></span>
        </th>
        <th style="padding-right: 6px">
          Ontology
          <span class="popup_container" style="padding-left: 1.7em;"><span class="bp_popup_link_container"><a href="javascript:void(0);" id="filter_ontologies" class="bp_popup_link">filter</a></span><div id="ontology_filter_list" class="bp_popup_list" style="display: none;"></div></span>
        </th>
        <th>Match Type</th>
        <th>UMLS Sem Type</th>
        <th>Context</th>
      </tr>
    </thead>
  </table>

  <div id="download_links" style="margin-top: 1.5em;">
    <table border=0 style="border: 0; margin-bottom: .5em;">
      <tr>
        <td style="padding: 0 3px 0 0;"><b>Download Results </b></td>
        <td id="download_links_text" style="padding: 3px;"></td>
        <td id="download_links_tabdelimited" style="padding: 3px;"></td>
        <td id="download_links_xml" style="padding: 3px;"></td>
      </tr>
    </table>
    <span style="font-size: 8pt;">Parameters for use in POST:&nbsp;&nbsp;&nbsp;<span id="annotator_parameters" style="color: gray; font-weight: bold;"></span></span>
  </div>
</div>


