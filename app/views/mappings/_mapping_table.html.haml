%table#concept_mappings_table.zebra{:width => "100%"}
  %thead
    %tr
      - if @delete_mapping_permission
        %th
      %th Mapping To
      %th Ontology
      %th Source
  - if @mappings.length < 1
    %tr
      %td{:colspan => @delete_mapping_permission ? "4" : "3"} There are currently no mappings for this class.

  - @mappings.each do |m|
    -# next if m.classes.map {|c| c.instance_of? LinkedData::Client::Models::Class }.to_set != [true].to_set
    - m.classes.each do |cls|
      - next if cls.id == @concept.id
      - ont = cls.explore.ontology
      - begin
        - ont_acronym = ont.acronym
        - ont_name = ont.name
        - ont_link = "/ontologies/#{ont_acronym}"
        - ont_restricted = false
      - rescue
        -# Work around ontologies with access restrictions
        - ont_restricted = true
        -# ont_acronym = cls.links['ontology'].split('/').last
        -# ont_name = ont_acronym  # no way to get the name here?
        -# ont_link = ''  # no link to restricted ontologies
      - next if ont_restricted

      %tr.human{:id => m.id.split("/").last}
        - if @delete_mapping_permission
          %td{:style => "padding: 6px 12px;"}
            - if session[:user].id.to_i == m.user_id || session[:user].admin?
              = check_box_tag :delete_mapping, m.id
        %td
          = link_to "#{cls.id}<span href='/ajax/classes/label?ontology=#{ont_acronym}&concept=#{CGI.escape(cls.id)}' class='get_via_ajax'></span>", :controller => 'visualize', :action => 'virtual', :id => ont_acronym, :conceptid => cls.id
        %td
          %a{:href => ont_link}= ont_name
        %td
          #{m.process.map {|p| p.name}.join(", ")}
