(function(a){a.fn.NCBOAutocomplete=function(c){var d={url:"",data:[],minCharacters:1,maxResults:undefined,wildCard:"",caseSensitive:false,notCharacter:"!",maxHeight:350,highlightMatches:true,onSelect:undefined,width:undefined,property:"text",searchParameter:"search",additionalParameters:{},resultAttribute:null,searchTextSuffix:""},b;c=a.extend(d,c);return this.each(function(){function h(s,w){var t=["/",".","*","+","?","|","(",")","[","]","{","}","\\"];if(w){for(var v=0;v<t.length;v++){if(t[v]===w){t.splice(v,1)}}}var u=new RegExp("(\\"+t.join("|\\")+")","g");return s.replace(u,"\\$1")}var l=a(this),g=new RegExp(h(c.wildCard||""),"g"),m=a("<ul />"),i,k,j;function f(s){l.val(s[c.property]);a(m).html("").hide();if(typeof c.onSelect==="function"){c.onSelect(s,l)}}function n(t,y,v,z){var w=a.extend({scrollTarget:y,offsetTop:185,duration:0,easing:"linear"},v);var s=a(t);var u=(typeof w.scrollTarget==="number")?w.scrollTarget:a(w.scrollTarget);var x=(typeof u==="number")?u:u.offset().top+s.scrollTop()-parseInt(w.offsetTop,10);s.animate({scrollTop:x},parseInt(w.duration,10),w.easing)}function e(s){a("li a",m).removeClass("ui-state-hover");if(s){a("a",s).addClass("ui-state-hover")}i=s}function r(v,s){s="("+s+")";var z=true,t,y=0,w=c.caseSensitive?new RegExp(s,"g"):new RegExp(s,"ig");a(m).html("").hide();for(t=0;t<v.length;t+=1){var u=a("<li />"),x=v[t][c.property];if(c.highlightMatches===true){x=x.replace(w,"<strong>$1</strong>")}a(u).append('<a class="ui-corner-all">'+x+"</a>");if(typeof v[t].image==="string"){a(">a",u).prepend('<img src="'+v[t].image+'" />')}if(typeof v[t].extra==="string"){a(">a",u).append("<small>"+v[t].extra+"</small>")}a(u).addClass("ui-menu-item").addClass((z)?"odd":"even").attr("role","menuitem").click((function(A){return function(){f(v[A])}})(t)).mouseover((function(A){return function(){e(A)}})(u));a(m).append(u);z=!z;y+=1;if(typeof c.maxResults==="number"&&y>=c.maxResults){break}}if(a("li",m).length>0){i=undefined;a(m).show().css("height","auto");if(a(m).height()>c.maxHeight){a(m).css({overflow:"auto",height:c.maxHeight+"px"})}}}function o(t){var s=function(y){if(this.value.length<c.minCharacters){q();return false}var z=[],w=(!c.wildCard)?h(this.value):h(this.value,c.wildCard).replace(g,".*"),v=true,A,x;if(c.notCharacter&&w.indexOf(c.notCharacter)===0){w=w.substr(c.notCharacter.length,w.length);if(w.length>0){v=false}}w=w||".*";w=c.wildCard?"^"+w:w;A=c.caseSensitive?new RegExp(w):new RegExp(w,"i");for(x=0;x<y.length;x+=1){if(A.test(y[x][c.property])===v){z.push(y[x])}}r(z,w)};if(c.data&&c.data.length){s.apply(this,[c.data])}else{if(c.url&&typeof c.url==="string"){var u=this.value;if(u.length<c.minCharacters){q();return false}a(m).html('<li class="ui-menu-item ajaxSearching"><a class="ui-corner-all">Searching...</a></li>').show().css("height","auto");b=window.clearTimeout(b);b=window.setTimeout(function(){var v={};v[c.searchParameter]=u+c.searchTextSuffix;a.extend(v,c.additionalParameters);a.getJSON(c.url,v,function(x){if(x){var w=(c.resultAttribute===null)?x:x[c.resultAttribute];r(w,u)}else{q()}})},500)}}}function q(){a(m).html("").hide()}function p(s){switch(s.keyCode){case 9:case 27:case 16:case 17:case 18:case 20:case 91:case 93:case 144:case 224:return false;case 13:a(i).trigger("click");return false;case 40:if(typeof i==="undefined"){i=a("li:first",m).get(0)}else{i=a(i).next().get(0)}e(i);if(i){n(m,i)}return false;case 38:if(typeof i==="undefined"){i=a("li:last",m).get(0)}else{i=a(i).prev().get(0)}e(i);if(i){n(m,i)}return false;default:o.apply(this,[s])}}a(m).addClass("jsonSuggest ui-autocomplete ui-menu ui-widget ui-widget-content ui-corner-all").attr("role","listbox").css({top:(l.position().top+l.outerHeight())+"px",left:l.position().left+"px",width:c.width||(l.outerWidth()+"px"),"z-index":999}).hide();l.after(m).keydown(p).blur(function(t){var s=a(m).offset();s.bottom=s.top+a(m).height();s.right=s.left+a(m).width();if(j<s.top||j>s.bottom||k<s.left||k>s.right){a(m).hide()}}).focus(function(s){a(m).css({top:(l.position().top+l.outerHeight())+"px",left:l.position().left+"px"});if(a("li",m).length>0){a(m).show()}}).attr("autocomplete","off");a(window).mousemove(function(s){k=s.pageX;j=s.pageY});c.notCharacter=h(c.notCharacter||"");if(c.data&&typeof c.data==="string"){c.data=a.parseJSON(c.data)}})}})(jQuery);